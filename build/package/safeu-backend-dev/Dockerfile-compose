FROM golang:1.9.7

MAINTAINER TripleZ "me@triplez.cn"

WORKDIR $GOPATH/src/a2os/safeu-backend
ADD . $GOPATH/src/a2os/safeu-backend/

COPY conf/db.example.json $GOPATH/src/a2os/safeu-backend/conf/db.json

# Solution for Chinese special network enviornment 
RUN mkdir -p $GOPATH/src/golang.org/x/ && \
git clone https://github.com/golang/sys.git $GOPATH/src/golang.org/x/sys/
# RUN mkdir -p $GOPATH/src/golang.org/x/ && \
#     wget https://github.com/golang/sys/archive/master.zip && \
#     unzip master.zip -d $GOPATH/src/golang.org/x/sys/

# Add dependencies
RUN go get -u github.com/kardianos/govendor && go get github.com/pilu/fresh && govendor sync

# Build package
RUN go build .

EXPOSE 8080

ENTRYPOINT ["fresh"]
#ENTRYPOINT ["./safeu-backend-dev"]
